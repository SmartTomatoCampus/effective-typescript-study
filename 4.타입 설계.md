# Effective - #4장 타입 설계

![327754-eng](https://user-images.githubusercontent.com/34502254/168100406-8929de59-6ccb-4f91-981f-f520586eaf70.png)

## 아이템 28

**유효한 상태만 표현하는 타입을 지향하기**

타입을 잘 설계하면 코드는 직관적으로 작성할 수 있다. 그러나 타입 설계가 엉망이라면 어떠한 기억이나 문서도 도움이 되지 못한다.

효과적으로 타입을 설계하려면 유효한 상태만 표현할 수 있는 타입을 만들어 내는 것이 가장 중요하다.

- 유효한 상태와 무효한 상태를 둘 다 표현하는 타입은 혼란을 초래하기 쉽고 오류를 유발하게 된다.
- 유효한 상태만 표현하는 타입을 지향해야 한다. 코드가 길어지거나 표현하기 어렵지만 결국은 시간을 절약하고 고통을 줄일 수 있다.


## 아이템 29

**사용할 때는 너그럽게, 생성할 때는 엄격하게**

> TCP 구현체는 견고성의 일반적 원칙을 따라야 한다. 당신의 작업은 엄격하게 하고, 다른 사람의 작업은 너그럽게 받아들여야 한다.
> 

함수의 시그니처에도 비슷한 규칙을 적용해야 한다. 함수의 매개변수는 타입의 범위가 넓어도 되지만, 결과를 반환할 때는 일반적으로 타입의 범위가 더 구체적이어야 한다.

보통 매개변수 타입은 반환 타입에 비해 범위가 넓은 경향이 있다.

선택적 속성과 유니온 타입은 반환 타입보다 매개변수 타입에 더 일반적이다.

매개변수와 반환 타입의 재사용을 위해서 기본 형태와 느슨한 형태를 도입하는 것이 좋다.


## 아이템 30

**문서에 타입 정보를 쓰지 않기**

코드의 주석과 타입의 상태의 표기가 잘못되어있다면 해당 코드는 잘못된 코드라고 생각하게 된다.

값을 변경하지 않는다고 설명한는 주석도 좋지 않으며, 또한 매개변수를 변경하지 않는다는 주석도 사용하지 않는 것이 좋다.

readonly를 사용하여 규칙을 강제할 수 있게 하면 된다.

타입이 명확하지 않은 경우는 변수명에 단위 정보를 포함하는 것을 고려하는 것이 좋다.


## 아이템 31

**타입 주변에 null 값 배치하기**

값이 전부 null 이거나 전부 null이 아닌 경우로 분명히 구분된다면, 값이 섞여 있을 때보다 다루기가 쉽다. 

타입에 null을 추가하는 방식으로 이러한 경우를 모델링 할 수 있다.

null 아님 단언 대신 단순 if구문으로 체크할 수도 있다.

null은 2개의 타입이 존재하는 나와 null 인경우에만 사용해야 적극적으로 활용할 수 있다. 타입이 여러개이거나, 속성값이 불확실성한 값이라면 버그를 양산하게 된다.

null 인 경우가 필요한 속성은 프로미스로 바꾸면 안된다. 코드가 복잡해지고 모든 매서드가 비동기로 바뀌어야 한다.


## 아이템 32

**유니온의 인터페이스보다는 인터페이스의 유니온을 사용하기**

```tsx
interface FillLayer {
	layout : FillLayout;
	paint : FillPaint;
}
interface LineLayer {
	layout : LineLayout;
	paint : LinePaint;
}
interface PointLayer {
	layout : PointLayout;
	paint : PointPaint;
}

type Layer = FillLayer | LineLayer | PointLayer
```

- 타입의 속성들 간에 관계를 재대로 모델링하면, 타입스크립트가 코드의 정확성을 체크하는 데 도움이 된다.
- 타입의 구조를 손 댈 수 없는 상황이면 앞서 다룬 인터페이스의 유니온을 사용해서 속성 사이의 관계를 모델링 할 수 있다.
- 여러개의 선택적 필드가 동시에 값이 있거나 동시에 undefined인 경우도 태그된 유니온 패턴이 잘 맞는다.
- 유니온 타입의 속성을 여러 개 가지는 인터페이스에서는 속성 간의 관계가 분명하지 않기 때문에 실수가 자주 발생한다.

- 유니온의 인터페이스보다 인터페이스의 유니온이 더 정확하고 타입스크립트가 이해하기가 더 좋다.
- 타입스크립트가 제어 흐름을 분석할 수 있도록 타입에 태그를 넣는 것을 고려해야 한다.
- 태그된 유니온은 타입스크립트와 매우 잘 맞기 때문에 자주 볼 수 있는 패턴이다.
